@startuml Agricultural Supply Chain ERD

' Entity Definitions

entity "Farmer" as farmer {
  * farmer_id : VARCHAR(20) <<PK>>
  --
  * national_id : VARCHAR(14) <<UK>>
  * first_name : VARCHAR(50)
  * last_name : VARCHAR(50)
  * gender : CHAR(1)
  * date_of_birth : DATE
  * phone_number : VARCHAR(15)
  * district : VARCHAR(50)
  * subcounty : VARCHAR(50)
  * village : VARCHAR(50)
  gps_latitude : DECIMAL(10,8)
  gps_longitude : DECIMAL(11,8)
  * farm_size_acres : DECIMAL(8,2)
  * primary_crop : VARCHAR(50)
  cooperative_id : VARCHAR(20) <<FK>>
  * registration_date : TIMESTAMP
  * blockchain_wallet : VARCHAR(64) <<UK>>
  * is_active : BOOLEAN
}

entity "Cooperative" as cooperative {
  * cooperative_id : VARCHAR(20) <<PK>>
  --
  * cooperative_name : VARCHAR(100)
  * registration_number : VARCHAR(30)
  * district : VARCHAR(50)
  * contact_person : VARCHAR(100)
  * phone_number : VARCHAR(15)
  * email : VARCHAR(100)
  * established_date : DATE
  * member_count : INTEGER
  * is_active : BOOLEAN
}

entity "Product" as product {
  * product_id : VARCHAR(20) <<PK>>
  --
  * product_name : VARCHAR(50)
  * category : VARCHAR(30)
  * variety : VARCHAR(50)
  * unit_of_measure : VARCHAR(10)
  * season : VARCHAR(20)
  * avg_growing_days : INTEGER
  * is_perishable : BOOLEAN
}

entity "Market" as market {
  * market_id : VARCHAR(20) <<PK>>
  --
  * market_name : VARCHAR(100)
  * market_type : VARCHAR(30)
  * district : VARCHAR(50)
  * subcounty : VARCHAR(50)
  gps_latitude : DECIMAL(10,8)
  gps_longitude : DECIMAL(11,8)
  * operating_days : VARCHAR(50)
  * capacity_kg : DECIMAL(12,2)
  * is_active : BOOLEAN
}

entity "Buyer" as buyer {
  * buyer_id : VARCHAR(20) <<PK>>
  --
  * buyer_name : VARCHAR(100)
  * buyer_type : VARCHAR(30)
  * contact_person : VARCHAR(100)
  * phone_number : VARCHAR(15)
  * email : VARCHAR(100)
  * district : VARCHAR(50)
  * registration_number : VARCHAR(30)
  * blockchain_wallet : VARCHAR(64) <<UK>>
  * is_active : BOOLEAN
}

entity "Transaction" as transaction {
  * transaction_id : VARCHAR(30) <<PK>>
  --
  * farmer_id : VARCHAR(20) <<FK>>
  * buyer_id : VARCHAR(20) <<FK>>
  * product_id : VARCHAR(20) <<FK>>
  * market_id : VARCHAR(20) <<FK>>
  * quantity_kg : DECIMAL(10,2)
  * quality_grade : CHAR(1)
  * unit_price : DECIMAL(10,2)
  * total_amount : DECIMAL(12,2)
  * transaction_date : TIMESTAMP
  * payment_method : VARCHAR(20)
  * payment_status : VARCHAR(20)
  * blockchain_hash : VARCHAR(64) <<UK>>
  * created_at : TIMESTAMP
}

entity "Harvest" as harvest {
  * harvest_id : VARCHAR(30) <<PK>>
  --
  * farmer_id : VARCHAR(20) <<FK>>
  * product_id : VARCHAR(20) <<FK>>
  * planting_date : DATE
  * harvest_date : DATE
  * quantity_kg : DECIMAL(10,2)
  * quality_assessment : VARCHAR(20)
  * post_harvest_loss_pct : DECIMAL(5,2)
  * storage_method : VARCHAR(50)
  * season : VARCHAR(20)
  * created_at : TIMESTAMP
}

entity "MarketPrice" as market_price {
  * price_id : VARCHAR(30) <<PK>>
  --
  * product_id : VARCHAR(20) <<FK>>
  * market_id : VARCHAR(20) <<FK>>
  * price_date : DATE
  * wholesale_price : DECIMAL(10,2)
  * retail_price : DECIMAL(10,2)
  * price_trend : VARCHAR(10)
  * source : VARCHAR(50)
  * created_at : TIMESTAMP
}

entity "WeatherData" as weather {
  * weather_id : VARCHAR(30) <<PK>>
  --
  * district : VARCHAR(50)
  * weather_date : DATE
  * temperature_min : DECIMAL(5,2)
  * temperature_max : DECIMAL(5,2)
  * temperature_avg : DECIMAL(5,2)
  * rainfall_mm : DECIMAL(6,2)
  * humidity_pct : DECIMAL(5,2)
  * wind_speed_kmh : DECIMAL(5,2)
  * weather_condition : VARCHAR(30)
  * source : VARCHAR(50)
}

entity "SubsidyProgram" as subsidy {
  * subsidy_id : VARCHAR(30) <<PK>>
  --
  * program_name : VARCHAR(100)
  * program_type : VARCHAR(50)
  * start_date : DATE
  * end_date : DATE
  * budget_amount : DECIMAL(15,2)
  * implementing_agency : VARCHAR(100)
  * is_active : BOOLEAN
}

entity "FarmerSubsidy" as farmer_subsidy {
  * farmer_subsidy_id : VARCHAR(30) <<PK>>
  --
  * farmer_id : VARCHAR(20) <<FK>>
  * subsidy_id : VARCHAR(30) <<FK>>
  * subsidy_type : VARCHAR(50)
  * amount_value : DECIMAL(10,2)
  * distribution_date : DATE
  * verification_status : VARCHAR(20)
  * created_at : TIMESTAMP
}

entity "BlockchainTransaction" as blockchain_tx {
  * blockchain_tx_id : VARCHAR(64) <<PK>>
  --
  * transaction_id : VARCHAR(30) <<FK>>
  * block_number : BIGINT
  * block_timestamp : TIMESTAMP
  * from_wallet : VARCHAR(64)
  * to_wallet : VARCHAR(64)
  * transaction_type : VARCHAR(30)
  * payload_json : TEXT
  * chaincode_name : VARCHAR(50)
  * channel_name : VARCHAR(50)
  * is_valid : BOOLEAN
}

entity "UserIdentity" as user_identity {
  * user_id : VARCHAR(36) <<PK>>
  --
  * farmer_id : VARCHAR(20) <<FK>>
  * keycloak_id : VARCHAR(36) <<UK>>
  * username : VARCHAR(50) <<UK>>
  * email : VARCHAR(100)
  * phone_number : VARCHAR(15)
  * blockchain_wallet : VARCHAR(64) <<UK>>
  * role : VARCHAR(30)
  * is_active : BOOLEAN
  * created_at : TIMESTAMP
  * last_login : TIMESTAMP
}

' Relationships

farmer ||--o{ transaction : "sells produce"
farmer ||--o{ harvest : "records harvest"
farmer }o--|| cooperative : "member of"
farmer ||--o| user_identity : "has identity"
farmer ||--o{ farmer_subsidy : "receives"

buyer ||--o{ transaction : "purchases"

product ||--o{ transaction : "traded"
product ||--o{ harvest : "harvested"
product ||--o{ market_price : "priced"

market ||--o{ transaction : "location"
market ||--o{ market_price : "prices at"

transaction ||--|| blockchain_tx : "recorded on chain"

subsidy ||--o{ farmer_subsidy : "distributed to"

@enduml
